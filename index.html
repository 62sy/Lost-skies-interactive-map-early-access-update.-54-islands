<!DOCTYPE html>
<html>
<head>
  <title>Game Map</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    body, html { margin: 0; padding: 0; height: 100%; }
    #map {
  width: 100%;
  height: 100%;
  background: transparent;
  border: none;
  box-sizing: border-box;
  /* box-shadow removed for performance */
  will-change: transform;
  /* transform: rotate(180deg); */
  will-change: transform;
  transform: translateZ(0); /* hardware acceleration for smoother dragging */
    }
    .marker-circle {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  color: rgba(255,255,255,0.5); /* transparent numbers */
  font-weight: bold;
  font-family: sans-serif;
  font-size: 28px;
  line-height: 60px;
  text-align: center;
  background-color: rgba(243, 243, 243, 0.85); /* More opaque, less transparent */
  /* border: 2px solid white; */ /* removed white border */
  box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
  display: inline-block;
  position: relative;
  z-index: 1;
  overflow: hidden;
    }
    #compass {
      position: absolute;
      top: 50px;
      left: 50px;
      width: 200px;
      height: 200px;
      z-index: 1000;
      pointer-events: none;
    }
    /* Infinite sky texture background */
    body {
  background: linear-gradient(180deg, #e0f7fa 0%, #b3e5fc 60%, #a7c7e7 100%);
  background-repeat: repeat;
    }
    .leaflet-marker-icon {
      z-index: 500;
      opacity: 1;
      background: none;
    }
    #dropdown-popup {
      position: absolute;
      top: 20px;
      right: 55px;
      z-index: 2000;
    }
    #dropdown-btn {
      padding: 8px 16px;
      font-size: 16px;
      cursor: pointer;
    }
    #dropdown-list {
      display: none;
      background: white;
      border: 1px solid #ccc;
      max-height: 400px;
      overflow-y: auto;
      margin-top: 4px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    #dropdown-list ul {
      list-style: none;
      margin: 0;
      padding: 8px 16px;
    }
    #dropdown-list li {
      padding: 4px 0;
      font-size: 15px;
    }
  </style>
</head>
<body>
<div id="map"></div>
<img id="compass" src="compass.png" alt="Compass" />
<div id="dropdown-popup">
  <button id="dropdown-btn">Show Island List</button>
  <div id="dropdown-list">
    <ul>
      <li>1: Tutorial_Island_V35</li>
      <li>2: MS4_Island_With_Puzzles</li>
      <li>3: Verdent_Valley</li>
      <li>4: Portamis</li>
      <li>5: Craco</li>
      <li>6: Friendly_Fire</li>
      <li>7: Ravara</li>
      <li>8: Sanctum_of_the_Ancients</li>
      <li>9: Shattered_Peak</li>
      <li>10: Thieves_and_Retribution</li>
      <li>11: Time_Devours_All</li>
      <li>12: The_Valve_District</li>
      <li>13: The_Grand_Inventors_Mansion</li>
      <li>14: The_Spine</li>
      <li>15: At_Journeys_End</li>
      <li>16: Atlas_Isles</li>
      <li>17: Atlas_Palace</li>
      <li>18: Netherworld</li>
      <li>19: Crystalline_Mausoleum</li>
      <li>20: Data_Research_Facility</li>
      <li>21: Geode_Factory</li>
      <li>22: Hanging_Village_of_Ranva</li>
      <li>23: Harbored_Saborian_Citadel</li>
      <li>24: Hermit_Hideaway</li>
      <li>25: Lode_Vein</li>
      <li>26: Mountain_Valley</li>
      <li>27: Natures_respite</li>
      <li>28: Saborian_Central_Park</li>
      <li>29: Saborian_Training_Ground</li>
      <li>30: Serene_Cove</li>
      <li>31: Tall_Trees_Directors_Cut</li>
      <li>32: Temple_Core</li>
      <li>33: Temple_Down</li>
      <li>34: THE_WELL</li>
      <li>35: Toppled</li>
      <li>36: Traitors_Enclave</li>
      <li>37: Aquaduct_Island</li>
      <li>38: Atlas_Spire</li>
      <li>39: Cargo_Ship_B</li>
      <li>40: Dryftwood_River</li>
      <li>41: New_Redusa</li>
      <li>42: Relay_Station_D</li>
      <li>43: Sabor_research_facility_87</li>
      <li>44: Shattered</li>
      <li>45: Stitches</li>
      <li>46: Sundered_Moon</li>
      <li>47: Research_Facility_Theta</li>
      <li>48: Wandering_Mountain</li>
      <li>49: Mining_Settlement_of_Markil_v1</li>
      <li>50: INTERLINKED_04</li>
      <li>51: Lighthouse_Arabeth</li>
      <li>52: Doshi_export_test</li>
      <li>53: Resting_Titan</li>
      <li>54: Rupture</li>
    </ul>
  </div>
</div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
const map = L.map('map', {
  crs: L.CRS.Simple,
  minZoom: -6,
  maxZoom: -1,
  dragging: true,
  doubleClickZoom: false,
  touchZoom: false,
  scrollWheelZoom: 'zoom',
  preferCanvas: true,
  inertia: false,
  keyboard: false
});

// Transparent overlay code goes here!
function createTransparentOutsideCircleDataUrl(size, circleRadius, color) {
  const canvas = document.createElement('canvas');
  canvas.width = canvas.height = size;
  const ctx = canvas.getContext('2d');
  const cx = size / 2, cy = size / 2;
  ctx.globalAlpha = 0.5;
  ctx.fillStyle = color;
  ctx.fillRect(0, 0, size, size);
  ctx.globalCompositeOperation = 'destination-out';
  ctx.beginPath();
  ctx.arc(cx, cy, circleRadius, 0, 2 * Math.PI);
  ctx.fill();
  ctx.globalCompositeOperation = 'source-over';
  return canvas.toDataURL();
}

const overlaySize = 2000; // px (smaller for browser performance)
const overlayCircleRadius = 250; // px (center hole, scales with bounds)
const overlayColor = 'purple';
const overlayUrl = createTransparentOutsideCircleDataUrl(overlaySize, overlayCircleRadius, overlayColor);

// Scale bounds to match your map's drag area
L.imageOverlay(overlayUrl, [[-80000, -80000], [80000, 80000]], {
  opacity: 0.6,
  interactive: false,
  zIndex: 5
}).addTo(map);

// Add green circle boundary at map center
const boundaryCircle = L.circle([0, 0], {
  radius: 20000,
  color: 'rgba(128,0,128,0.5)', // transparent purple
  weight: 5,
  fill: false
}).addTo(map);

const customIcon = (number, color) => L.divIcon({
  className: '',
  html: `<div class="marker-circle" style="background-color: ${color};">${number}</div>`,
  iconSize: [30, 30],
  iconAnchor: [15, 15]
});

function getMarkerColor(level) {
  if (level >= 1 && level <= 7) return '#90ee90'; // very light green
  if (level >= 8 && level <= 10) return 'dark blue'; // dark blue
  if (level >= 11 && level <= 13) return 'orange';
  if (level >= 14 && level <= 15) return 'red';
  if (level >= 0) return 'purple';
  return 'gray';
}

const markersData = [
   { lat: 0, lng: -0, level: 0, name: 'Tutorial_Island_V35', number: 1, img: 'https://davemane42.github.io/LostSkiesInteractiveMap/img/islands/1.webp',
  details: {
    altitude: '1200m',
    hasArk: '✅',
    databanks: 5,
    largeChest: 'Not Reported',
    metals: 'Iron',
    woods: 'Pine, Birch',
    plants: 'Tomanana',
    animals: 'Common Sairhorn, Blue Manta',
    items: 'Not Reported'
  }
},
  { lat: 1050, lng: -2500, level: 4, name: 'MS4_Island_With_Puzzles', number: 2, img: 'https://davemane42.github.io/LostSkiesInteractiveMap/img/islands/7.webp',
  details: {
    altitude: '1400m',
    hasArk: '✅',
    databanks: 5,
    largeChest: 'Not Reported',
    metals: 'Not Reported',
    woods: 'Not Reported',
    plants: 'Not Reported',
    animals: 'Not Reported',
    items: 'Not Reported'
  }
},
  { lat: -9000, lng: 1500, level: 13, name: 'Verdent_Valley', number: 3, img: 'https://images.steamusercontent.com/ugc/2127446744788942316/0C878324EB1BB7EB03CD81B7AC4C421CBB934D96/?imw=637&imh=358&ima=fit&impolicy=Letterbox&imcolor=%23000000&letterbox=true',
  details: {
    altitude: '1800m',
    hasArk: '❌',
    databanks: 5,
    largeChest: 5,
    metals: 'Zinc, Silver, Aluminum',
    woods: 'Apotheon Pine',
    plants: 'Beans',
    animals: '', // Will not show in popup
    items: 'Glass Shards, Momorosian Nylon Cloth, Electric Filament'
  }
},
  { lat: 6000, lng: -2050, level: 9, name: 'Portamis', number: 4, img: 'https://images.steamusercontent.com/ugc/2317727638360524855/471956BC8B31C7DE87FEF6B76E231DC2FD9EBE31/?imw=5000&imh=5000&ima=fit&impolicy=Letterbox&imcolor=%23000000&letterbox=false',
  details: {
    altitude: '1200m',
    hasArk: '❌',
    databanks: 5,
    largeChest: 4,
    metals: 'Zinc, Tin, Iron',
    woods: 'Pillar Pine, Night Birch',
    plants: 'Azuberries, Gas Bulb',
    animals: 'Jellyfish, Bull Mantra, Sairhorn Stag',
    items: 'Glass Shards, Electric Filament, Tarnished Saborian Alloy, Lubricating Slime, Weapon Calibration SSD'
  }
},
  { lat: -10800, lng: 5400, level: 14, name: 'Craco', number: 5, img: 'https://davemane42.github.io/LostSkiesInteractiveMap/img/islands/21.webp',
  details: {
    metals: 'Tin, Zinc, Aluminum, Pure Aluminum',
    woods: 'Apotheon Pine',
    plants: 'Not Reported',
    animals: 'Tiger Manta, Bull Manta, Atlas Shrimp',
    items: 'Raw Underside Oyster, Tarnished Saborian Alloy, Momorosian Nylon Cloth, Electric Filament, Weapon Calibration SDD, Flight Records SDD, Silica',
    altitude: '1500m',
    hasArk: 'No',
    databanks: 5,
    largeChest: 9
  }
},
  { lat: 6000, lng: 9200, level: 11, name: 'Friendly_Fire', number: 6, img: 'https://automaticpotato.github.io/found-skies/covers/15.png',
  details: {
    altitude: '2100m',
    hasArk: '❌',
    databanks: 3,
    largeChest: 3,
    metals: 'Tin, Aluminum',
    woods: 'Redusian Birch, Apolleon Pine',
    plants: 'Beans, Tupau Nuts',
    animals: 'none?',
    items: 'Tarnished Saborian Alloy, Weapon Calibration SDD, Momorosian Nylon Cloth, Electric Filament'
  }
},
  { lat: 5400, lng: 4700, level: 8, name: 'Ravara', number: 7, img: 'https://davemane42.github.io/LostSkiesInteractiveMap/img/islands/7.webp',
  details: {
    altitude: '1100m',
    hasArk: '❌',
    databanks: 5,
    largeChest: 6,
    metals: 'Iron, Zinc',
    woods: 'Night Birch Wood',
    plants: 'Gas Bulb, Azuberries',
    animals: 'Nautilus, Bull Manta, Sairhorn Stag, Jellyfish',
    items: 'Not Reported'
  }
},
  { lat: 2400, lng: 700, level: 3, name: 'Sanctum_of_the_Ancients', number: 8, img: 'https://davemane42.github.io/LostSkiesInteractiveMap/img/islands/6.webp',
  details: {
    altitude: '1300m',
    hasArk: '✅',
    databanks: 6,
    largeChest: 'Not Reported',
    metals: 'Tin, Iron, Lead',
    woods: 'Pine, Birch',
    plants: 'Tomato, Tator Root, Eggs',
    animals: 'Not Reported',
    items: 'Rock Salt, Scrap Metal, stone'
  }
},
  { lat: -2100, lng: -2350, level: 3, name: 'Shattered_Peak', number: 9, img: 'https://davemane42.github.io/LostSkiesInteractiveMap/img/islands/2.webp',
  details: {
    altitude: '1500m',
    hasArk: '✅',
    databanks: 6,
    largeChest: '2?',
    metals: 'Tin, Lead, Iron',
    woods: 'Birch, Pine',
    plants: 'Tator Root, Tomato',
    animals: 'Not Reported',
    items: 'Not Reported'
  }
},
  { lat: -1200, lng: 4500, level: 8, name: 'Thieves_and_Retribution', number: 10, img: 'https://images.steamusercontent.com/ugc/17551964622352859702/C7060D1A35DA7A1C291CABAD05EEE24FD6C5E9EE/?imw=5000&imh=5000&ima=fit&impolicy=Letterbox&imcolor=%23000000&letterbox=false',
  details: {
    altitude: '1400m',
    hasArk: '✅',
    databanks: 5,
    largeChest: 'Not Reported',
    metals: 'Zinc, Tin, Copper',
    woods: 'Pillar Pine',
    plants: 'Gas Bulb, Azuberries',
    animals: 'Sairhorn Stag (purple), Nautilus',
    items: 'Glass Shards, Scrap Metal, Lubricating Slime, Electric Filament, Tarnished Saborian Alloy'
  }
},
  { lat: -7400, lng: -4900, level: 12, name: 'Time_Devours_All', number: 11, img: 'https://davemane42.github.io/LostSkiesInteractiveMap/img/islands/27.webp',
  details: {
    altitude: '1800m',
    hasArk: '✅',
    databanks: 4,
    largeChest: '6+',
    metals: 'Zinc, Copper',
    woods: 'Pillar Pine Wood, Night Birch Wood',
    plants: 'Azurberries, Gas Bulb',
    animals: 'Nautilus, Jellyfish, Bull Manta, Chief (bird), Blue Sairhorn, Sairhorn Stag',
    items: 'Grubs (underground), Electric Filament, Glass Shards, Seraph Nano Energy, Flight Records SDD (found in underground challenge area)'
  }
},
  { lat: -8550, lng: 7750, level: 15, name: 'The_Valve_District', number: 12, img: 'https://images.steamusercontent.com/ugc/2380783739882538752/3CED563759FCD6885D1A126039E84C521ED264C8/?imw=5000&imh=5000&ima=fit&impolicy=Letterbox&imcolor=%23000000&letterbox=false',
  details: {
    altitude: '1600m',
    hasArk: 'No',
    databanks: 5,
    largeChest: 'Not Reported',
    metals: 'Aluminum, Copper',
    woods: 'Redusian Pine, Redusian Birch',
    plants: 'Beans',
    animals: 'Crow',
    items: 'Raw Underside Oyster, glass shards, Tarnished Saborian Alloy, Momorosian Nylon Cloth, Electric Filament, Weapon Calibration SDD, Flight Records SDD, Grubs'
  }
},
  { lat: 8050, lng: -5700, level: 15, name: 'The_Grand_Inventors_Mansion', number: 13, img: 'https://images.steamusercontent.com/ugc/2453970404562727357/81564653AB7D697EA7A70A0F4A53A16E60DEC35D/?imw=637&imh=358&ima=fit&impolicy=Letterbox&imcolor=%23000000&letterbox=true',
  details: {
    altitude: '2100m',
    hasArk: '❌',
    databanks: 4,
    largeChest: 4,
    metals: 'Tin',
    woods: 'Redusian Birch',
    plants: 'Beans',
    animals: 'None',
    items: 'Tarnished Saborian Alloy, Momorosian Nylon, Flight Records SDD'
  }
},
  { lat: 1900, lng: 2750, level: 6, name: 'The_Spine', number: 14, img: 'https://images.steamusercontent.com/ugc/2506892769648802292/E14DCA3E575E2627620346A1F40A4B18E6AD496A/?imw=5000&imh=5000&ima=fit&impolicy=Letterbox&imcolor=%23000000&letterbox=false',
  details: {
    altitude: '1500m',
    hasArk: '❌',
    databanks: 5,
    largeChest: 'Not Reported',
    metals: 'Tin, Lead',
    woods: 'Birch',
    plants: 'Not Reported',
    animals: 'Not Reported',
    items: 'Not Reported'
  }
},
  { lat: -3900, lng: 1200, level: 6, name: 'At_Journeys_End', number: 15, img: 'https://images.steamusercontent.com/ugc/7424330444429012/8FF27E4B80412B332B1497AA674EDC51601EE61F/?imw=5000&imh=5000&ima=fit&impolicy=Letterbox&imcolor=%23000000&letterbox=false',
  details: {
    altitude: '1100m',
    hasArk: '❌',
    databanks: 5,
    largeChest: 4,
    metals: 'Iron, Tin, Zinc',
    woods: 'Birch',
    plants: 'Tomato, Gas Bulb',
    animals: 'Sairhorn Stag, Blue Manta',
    items: 'Not Reported'
  }
},
  { lat: 4400, lng: -10500, level: 7, name: 'Atlas_Isles', number: 16, img: 'https://images.steamusercontent.com/ugc/47955480899616070/75F11B90DABC5A9B110E829AB2EDD69DEA355839/?imw=5000&imh=5000&ima=fit&impolicy=Letterbox&imcolor=%23000000&letterbox=false',
  details: {
    altitude: '1500m',
    hasArk: '✅',
    databanks: 5,
    largeChest: 4,
    metals: 'Tin, Copper, Iron, Lead',
    woods: 'Birch, Pine',
    plants: 'Tomanana, Tomato',
    animals: 'None',
    items: 'Not Reported'
  }
},
  { lat: 2800, lng: 7900, level: 10, name: 'Atlas_Palace', number: 17, img: 'https://davemane42.github.io/LostSkiesInteractiveMap/img/islands/16.webp',
  details: {
    altitude: '1700m',
    hasArk: '✅',
    databanks: 5,
    largeChest: 4,
    metals: 'Zinc, Tin',
    woods: 'Night Birch, Pillar Pine',
    plants: 'Not Reported',
    animals: 'Sairhorn Stag, Nautilus',
    items: 'Tarnished Saborian Alloy, Lubricating Slime, Electric Filament, Glass shards'
  }
},
  { lat: 4000, lng: 11600, level: 8, name: 'Netherworld', number: 18, img: 'https://images.steamusercontent.com/ugc/2505775749471656819/3F4ED33DB8E7772CF94B9D3FBA33F12A79506A04/?imw=5000&imh=5000&ima=fit&impolicy=Letterbox&imcolor=%23000000&letterbox=false',
  details: {
    altitude: '1600m',
    hasArk: '✅',
    databanks: 5,
    largeChest: 4,
    metals: 'Lead',
    woods: 'Pine, Birch',
    plants: 'Daccat Berries, Tomato, Tator Root, Eggs',
    animals: 'Common Sairhorn, Atlas Shrimp, Birds',
    items: 'Scrap Metal, Silica, Seraph Nano Energy'
  }
},
  { lat: 1110, lng: -10800, level: 7, name: 'Crystalline_Mausoleum', number: 19, img: 'https://davemane42.github.io/LostSkiesInteractiveMap/img/islands/10.webp',
  details: {
    altitude: '1000m',
    hasArk: '✅',
    databanks: 4,
    largeChest: 5,
    metals: 'Iron, Tin',
    woods: 'Pine',
    plants: 'Tater Root, Eggs, Tomato, Tomanana',
    animals: 'Common Sairhorn, Blue Manta, Sairhorn Stag',
    items: 'Not Reported'
  }
},
  { lat: 8800, lng: -1500, level: 12, name: 'Data_Research_Facility', number: 20, img: 'https://images.steamusercontent.com/ugc/35571099084413811/83CDCEAAAC3DC50B08BEFA8157D7CB5746618784/?imw=5000&imh=5000&ima=fit&impolicy=Letterbox&imcolor=%23000000&letterbox=false',
  details: {
    altitude: '1600m',
    hasArk: '❌',
    databanks: 4,
    largeChest: 5,
    metals: 'Lead',
    woods: 'Redusian Birch',
    plants: 'Tupau Nuts',
    animals: 'Tiger Manta',
    items: 'Weapon Calibration SDD, Momorosian Nylon Cloth, Electrical Filaments, Glass Shards'
  }
},
  { lat: -5400, lng: 6150, level: 12, name: 'Geode_Factory', number: 21, img: 'https://images.steamusercontent.com/ugc/36697728021101431/F0F38143D14CC30ABED1D9B2B85FA3B4C9648149/?imw=637&imh=358&ima=fit&impolicy=Letterbox&imcolor=%23000000&letterbox=true',
  details: {
    altitude: '900m',
    hasArk: '❌',
    databanks: 4,
    largeChest: 'Not Reported',
    metals: 'Tin, Zinc, Aluminum',
    woods: 'Apotheon Pine, Redusian Birch Wood',
    plants: 'Not Reported',
    animals: 'Not Reported',
    items: 'Tarnished Saborian Alloy, Glass Shards, Raw Underside Oyster'
  }
},
  { lat: 6000, lng: 650, level: 10, name: 'Hanging_Village_of_Ranva', number: 22, img: 'https://images.steamusercontent.com/ugc/10825048028014510401/0107ABFA6D860D2EF21C5671F9E51C90CBDD8B4F/?imw=5000&imh=5000&ima=fit&impolicy=Letterbox&imcolor=%23000000&letterbox=false',
  details: {
    altitude: '2000m',
    hasArk: '❌',
    databanks: 4,
    largeChest: 3,
    metals: 'Zinc, Copper',
    woods: 'Night Birch',
    plants: 'Not Reported',
    animals: 'Not Reported',
    items: 'Not Reported'
  }
},
  { lat: 8100, lng: 6300, level: 12, name: 'Harbored_Saborian_Citadel', number: 23, img: 'https://images.steamusercontent.com/ugc/11920957430047008/E83F336E2741DA0FB7FB93FC11714AE4521BB367/?imw=5000&imh=5000&ima=fit&impolicy=Letterbox&imcolor=%23000000&letterbox=false',
  details: {
    altitude: '1600m',
    hasArk: '❌',
    databanks: 5,
    largeChest: 6,
    metals: 'Aluminium, Zinc, Silver',
    woods: 'Apotheon Pine',
    plants: 'Beans',
    animals: 'Tiger Manta',
    items: 'Glass Shards, Raw Underside Oyster, Flight Records SDD, Electric Filament, Tarnished Saborian Alloy, Momorosian Nylon Cloth'
  }
},
  { lat: -6000, lng: 3700, level: 10, name: 'Hermit_Hideaway', number: 24, img: 'https://images.steamusercontent.com/ugc/35571099084374384/092D74973E3EE79A2905C903DC4EDF1CABF80BED/?imw=637&imh=358&ima=fit&impolicy=Letterbox&imcolor=%23000000&letterbox=true' },
  { lat: 2900, lng: -5000, level: 6, name: 'Lode_Vein', number: 25, img: 'https://davemane42.github.io/LostSkiesInteractiveMap/img/islands/8.webp',
  details: {
    altitude: '900m',
    hasArk: '✅',
    databanks: 3,
    largeChest: 4,
    metals: 'Iron, Lead, Tin, Copper',
    woods: 'Pine',
    plants: 'Tomato, Tomanana, Deccat Berries, Tator Root',
    animals: 'Blue Manta, Sairhorn Buck, Common Sairhorn',
    items: 'Rock Salt, Silica'
  }
},
  { lat: 950, lng: 12600, level: 7, name: 'Mountain_Valley', number: 26, img: 'https://davemane42.github.io/LostSkiesInteractiveMap/img/islands/17.webp',
  details: {
    altitude: '900m',
    hasArk: '✅',
    databanks: 4,
    largeChest: 5,
    metals: 'Iron, Tin, Copper, Lead',
    woods: 'Pine, Birch',
    plants: 'Tomanana, Tomato, Daccat Berries, Tator Root',
    animals: 'Sairhorn Buck, Common Sairhorn, Blue Manta',
    items: 'Scrap metal'
  }
},
  { lat: -1100, lng: -6400, level: 6, name: 'Natures_respite', number: 27, img: 'https://images.steamusercontent.com/ugc/18682083349082801/FA1FDC71DCE5D0D91EC430FC92341226632C7823/?imw=637&imh=358&ima=fit&impolicy=Letterbox&imcolor=%23000000&letterbox=true',
  details: {
    altitude: '1400m',
    hasArk: '❌',
    databanks: 1,
    largeChest: 0,
    metals: 'None',
    woods: 'Birch',
    plants: 'None',
    animals: 'None',
    items: 'None'
  }
},
  { lat: 2500, lng: -8400, level: 9, name: 'Saborian_Central_Park', number: 28, img: 'https://images.steamusercontent.com/ugc/13759587820867504466/A27E2E814F1BAD5072883A9D93550D439C4E98E0/?imw=5000&imh=5000&ima=fit&impolicy=Letterbox&imcolor=%23000000&letterbox=false',
  details: {
    altitude: '900m',
    hasArk: '❌',
    databanks: 5,
    largeChest: 'Not Reported',
    metals: 'Iron, Zinc',
    woods: 'Pillar Pine, Night Birch',
    plants: 'Gas Bulb',
    animals: 'Nautilus, Blue Sairhorn, Blue Sairhorn Stag',
    items: 'Lubricating Slime, Glass Shards, Scrap Metal'
  }
},
  { lat: -9150, lng: -800, level: 13, name: 'Saborian_Training_Ground', number: 29, img: 'https://images.steamusercontent.com/ugc/16748347838070984492/95DAADC3C0749081BBB2486489B4221540B34EA1/?imw=268&imh=151&ima=fit&impolicy=Letterbox&imcolor=%23000000&letterbox=true',
  details: {
    altitude: '2200m',
    hasArk: '❌',
    databanks: 5,
    largeChest: 4,
    metals: 'Aluminium, Zinc, Silver',
    woods: 'Redusian Birch',
    plants: '', // Will not show in popup
    animals: '', // Will not show in popup
    items: 'Tarnished Saborian Alloy, Momorosian Nylon Cloth, Glass Shards, Grubs, Weapon Calibration SDD, Flight Records SDD'
  }
},
  { lat: 100, lng: 8800, level: 6, name: 'Serene_Cove', number: 30, img: 'https://images.steamusercontent.com/ugc/20926872368592668/B718F8A1BA3C9DB3C287AC6386E107162074895F/?imw=637&imh=358&ima=fit&impolicy=Letterbox&imcolor=%23000000&letterbox=true',
  details: {
    altitude: '1600m',
    hasArk: '❌',
    databanks: 2,
    largeChest: 0,
    metals: 'Tin',
    woods: 'Pine Wood',
    plants: 'Tomato',
    animals: 'Atlas Shrimp',
    items: 'Not Reported'
  }
},
  { lat: -3900, lng: -6900, level: 10, name: 'Tall_Trees_Directors_Cut', number: 31, img: 'https://images.steamusercontent.com/ugc/11925850702225041/8F358658B67641577A880EBF32652AF60E3540A4/?imw=637&imh=358&ima=fit&impolicy=Letterbox&imcolor=%23000000&letterbox=true',
  details: {
    altitude: '1000m',
    hasArk: '❌',
    databanks: 5,
    largeChest: 3,
    metals: 'Zinc, Iron',
    woods: 'Pillar Pine, Night Birch',
    plants: 'Azuberries, Gas Bulb',
    animals: 'Bull Manta, Jellyfish, Blue Sairhorn, Sairhorn Stag (Blue), Nautilus, Chief (bird)',
    items: 'Electric Filament, Glass Shards, Silica, Tarnished Saborian Alloy, Lubricating Slime, Seraph Nano Energy'
  }
},
  { lat: -8000, lng: -8250, level: 14, name: 'Temple_Core', number: 32, img: 'https://davemane42.github.io/LostSkiesInteractiveMap/img/islands/23.webp',
  details: {
    altitude: '900m',
    hasArk: '❌',
    databanks: 4,
    largeChest: 5,
    metals: 'Aluminium, Silver, Tin',
    woods: 'Apotheon Pine',
    plants: 'Beans',
    animals: 'Tiger Manta, Bull Manta',
    items: 'Tarnished Saborian Alloy, Momorosian Nylon Cloth, Weapon Calibration SDD, Electrical Filament, Glass Shards, Raw Underside Oyster, Flight Records SDD, Grubs'
  }
},
  { lat: 9100, lng: 2800, level: 14, name: 'Temple_Down', number: 33, img: 'https://davemane42.github.io/LostSkiesInteractiveMap/img/islands/33.webp',
  details: {
    altitude: '1400m',
    hasArk: '❌',
    databanks: 4,
    largeChest: 4,
    metals: 'Aluminium, Tin, Zinc',
    woods: 'Apotheon Pine, Redusian Birch',
    plants: 'Tupau Nuts, Beans',
    animals: 'Tiger Manta, Bull Manta, Shrimp',
    items: 'Tarnished Saborian Alloy, Momorosian Nylon Cloth, Underside Oyster, Grubs, Glass Shards, Eggs, Silica, Weapon Calibration SDD, Flight Records SDD'
  }
},
  { lat: -6050, lng: -600, level: 10, name: 'THE_WELL', number: 34, img: 'https://images.steamusercontent.com/ugc/13049847197789538/688CB5A5F9987CB0B9AB1F0AD7330B72A57BB1A4/?imw=637&imh=358&ima=fit&impolicy=Letterbox&imcolor=%23000000&letterbox=true',
  details: {
    altitude: '1400m',
    hasArk: '❌',
    databanks: 5,
    largeChest: 'Not Reported',
    metals: 'Zinc, Copper?, Iron?',
    woods: 'Pillar Pine',
    plants: 'Azuberries, Gas Bulbs',
    animals: 'Nautilus',
    items: 'Tarnished Saborian Alloy, Glass Shards, Electric Filament, Grubs, lubricant gel'
  }
},
  { lat: -3150, lng: 9250, level: 10, name: 'Toppled', number: 35, img: 'https://images.steamusercontent.com/ugc/35571099090522832/322BDB9AC5196337F014974007826695E184C22A/?imw=637&imh=358&ima=fit&impolicy=Letterbox&imcolor=%23000000&letterbox=true',
  details: {
    altitude: '1200m',
    hasArk: '✅',
    databanks: 4,
    largeChest: 'Not Reported',
    metals: 'Tin, Zinc',
    woods: 'Night Birch, Pillar Pine',
    plants: 'Gas Bulb',
    animals: 'Jellyfish',
    items: 'Not Reported'
  }
},
  { lat: -1700, lng: -9150, level: 10, name: 'Traitors_Enclave', number: 36, img: 'https://davemane42.github.io/LostSkiesInteractiveMap/img/islands/24.webp',
  details: {
    altitude: '1600m',
    hasArk: '❌',
    databanks: 1,
    largeChest: 1,
    metals: 'Zinc, Tin',
    woods: 'Pillar Pine, Night Birch',
    plants: 'Azuberries, Gas Bulb',
    animals: 'None',
    items: 'Silica, Lubricating Slime'
  }
},
  { lat: -500, lng: -14600, level: 8, name: 'Aquaduct_Island', number: 37, img: 'https://images.steamusercontent.com/ugc/27693518483867402/C321BF4CBFAF60AFE7113C17D97B5E3BD4D8C35E/?imw=637&imh=358&ima=fit&impolicy=Letterbox&imcolor=%23000000&letterbox=true' },
  { lat: -2800, lng: 12800, level: 8, name: 'Atlas_Spire', number: 38, img: 'https://images.steamusercontent.com/ugc/42320254923492141/19C9122D9D02395EEF1390F70CD92BFCCC3EE033/?imw=637&imh=358&ima=fit&impolicy=Letterbox&imcolor=%23000000&letterbox=true' },
  { lat: -10600, lng: -6500, level: 13, name: 'Cargo_Ship_B', number: 39, img: 'https://images.steamusercontent.com/ugc/36698355671393540/5A153A366C147017915DD08E178C0B7D17C79C94/?imw=637&imh=358&ima=fit&impolicy=Letterbox&imcolor=%23000000&letterbox=true' },
  { lat: 12250, lng: 1200, level: 13, name: 'Dryftwood_River', number: 40, img: 'https://images.steamusercontent.com/ugc/12485074223546072709/AB6D7DC51EB30071FF374C996684167E537B9A20/?imw=637&imh=358&ima=fit&impolicy=Letterbox&imcolor=%23000000&letterbox=true' },
  { lat: 11000, lng: -8000, level: 12, name: 'New_Redusa', number: 41, img: 'https://images.steamusercontent.com/ugc/12941666969162637756/4FFD22C6D15944241FD0223CD5B529726491C9CA/?imw=637&imh=358&ima=fit&impolicy=Letterbox&imcolor=%23000000&letterbox=true' },
  { lat: 3900, lng: -12800, level: 10, name: 'Relay_Station_D', number: 42, img: 'https://images.steamusercontent.com/ugc/1796636835345802/8BB91ECB6EA0E360D02724EBA16EB4E2203062A6/?imw=5000&imh=5000&ima=fit&impolicy=Letterbox&imcolor=%23000000&letterbox=false' },
  { lat: 3550, lng: 14200, level: 11, name: 'Sabor_research_facility_87', number: 43, img: 'https://images.steamusercontent.com/ugc/17855666951499294874/F2A1580A507EBDAC26373B9F665E4AC3033D2AB4/?imw=637&imh=358&ima=fit&impolicy=Letterbox&imcolor=%23000000&letterbox=true',
  details: {
    altitude: '800m',
    hasArk: '✅',
    databanks: 5,
    largeChest: 'Not Reported',
    metals: 'Zinc',
    woods: 'Pillar Pine',
    plants: 'Azuberries, Gas Bulb',
    animals: 'Jellyfish, Nautilus',
    items: 'Lubricating Slime, Burning Coral'
  }
},
  { lat: -5800, lng: -11000, level: 8, name: 'Shattered', number: 44, img: 'https://images.steamusercontent.com/ugc/17184726129550996517/299616ED357C4D7271FC6E8D87656D21697BEC6A/?imw=637&imh=358&ima=fit&impolicy=Letterbox&imcolor=%23000000&letterbox=true' },
  { lat: 7200, lng: 12650, level: 4, name: 'Stitches', number: 45, img: 'https://images.steamusercontent.com/ugc/18682599225519426/324CDB40CE5BE7E1EA28148AFFE7EB61D280E106/?imw=637&imh=358&ima=fit&impolicy=Letterbox&imcolor=%23000000&letterbox=true',
  details: {
    altitude: '1800m',
    hasArk: '❌',
    databanks: 1,
    largeChest: 1,
    metals: 'Lead',
    woods: 'Pine, Birch',
    plants: 'Daccat Berries',
    animals: 'None',
    items: 'None'
  }
},
  { lat: -7000, lng: 11650, level: 13, name: 'Sundered_Moon', number: 46, img: 'https://media.discordapp.net/attachments/1114978152620511265/1397629189741482114/46.png?ex=68826b1d&is=6881199d&hm=38cd58f537dde5ef8d468da1d2b23684a40348e09e193e7277bb589fa50fd05b&=&format=webp&quality=lossless&width=1077&height=708' },
  { lat: 11900, lng: 5250, level: 10, name: 'Research_Facility_Theta', number: 47, img: 'https://images.steamusercontent.com/ugc/61459269001702322/3FD5B168F020C37DE056660B79D9366409F87D04/?imw=637&imh=358&ima=fit&impolicy=Letterbox&imcolor=%23000000&letterbox=true',
  details: {
    altitude: '1600m',
    hasArk: '❌',
    databanks: 5,
    largeChest: 4,
    metals: 'Lead',
    woods: 'Pillar Pine',
    plants: 'Not Reported',
    animals: 'Nautilus, Blue Sairhorn, Sairhorn Stag, Jellyfish, Bull Manta, Birds',
    items: 'Scrap Metal, Electric Filament, Momorosian Nylon Cloth, Seraph Nano Energy, Flight Records SSD'
  }
},
  { lat: 9450, lng: 8850, level: 8, name: 'Wandering_Mountain', number: 48, img: 'https://images.steamusercontent.com/ugc/10910435218475709033/79F0193962D114F6F3C34F76FF5E4B5F976CE6BD/?imw=637&imh=358&ima=fit&impolicy=Letterbox&imcolor=%23000000&letterbox=true',
  details: {
    altitude: '1500m',
    hasArk: '❌',
    databanks: 3,
    largeChest: 2,
    metals: 'Copper, Tin',
    woods: 'Pine, Birch',
    plants: 'Daccat Berries, Tomato, Tator Root, Eggs',
    animals: 'Sairhorn Buck, Common Sairhorn, Blue Manta, Atlas Shrimp',
    items: 'Scrap Metal, Silica, Rock Salt'
  }
},
  { lat: -11200, lng: 8900, level: 11, name: 'Mining_Settlement_of_Markil_v1', number: 49, img: 'https://images.steamusercontent.com/ugc/16330827621795919660/24F9D34A19A54952794BF0165FD55CF51F96C2DB/?imw=637&imh=358&ima=fit&impolicy=Letterbox&imcolor=%23000000&letterbox=true' },
  { lat: -12250, lng: -2800, level: 13, name: 'INTERLINKED_04', number: 50, img: 'https://images.steamusercontent.com/ugc/7423600166260495/67524D063EC5FB6E4D16290897D34938526EE753/?imw=637&imh=358&ima=fit&impolicy=Letterbox&imcolor=%23000000&letterbox=true',
    details: {
      altitude: '300',
      largeChest: 6,
      databanks: 5,
      hasArk: 'No',
      metals: 'Aluminium, Lead',
      woods: 'Pine',
      animals: 'Manta Tiger, Shrimp',
      items: 'Tarnished Saborian Alloy, Scrap Metal, Momorosian Nylon Cloth, Glass Shards, Stone, SSD, Coral, Grubs, Salt, Oyster, Slime',
      plants: 'Fiber, Berries, Azure, Tomato, Tomana, Beans, Mushroom, Eggs, Nuts, Potatos'
    }
  },
  { lat: 11150, lng: -4400, level: 10, name: 'Lighthouse_Arabeth', number: 51, img: 'https://images.steamusercontent.com/ugc/9661148044318056692/79616F63B2A854EA2C469ED7396678320640D416/?imw=5000&imh=5000&ima=fit&impolicy=Letterbox&imcolor=%23000000&letterbox=false' },
  { lat: 7900, lng: -10000, level: 9, name: 'Doshi_export_test', number: 52, img: 'https://images.steamusercontent.com/ugc/13055550628269333/E3D0EDD92D4AFCD2DC1D22D1DAA71BD616EA322C/?imw=637&imh=500&ima=fit&impolicy=Letterbox&imcolor=%23000000&letterbox=true' },
  { lat: -12650, lng: 1900, level: 13, name: 'Resting_Titan', number: 53, img: 'https://images.steamusercontent.com/ugc/14364650787230671269/B0E27B3458DBAD61FB5258540F700CBF4E1A079B/?imw=637&imh=500&ima=fit&impolicy=Letterbox&imcolor=%23000000&letterbox=true',
    details: {
      altitude: '300',
      largeChest: 5,
      databanks: 5,
      hasArk: 'No',
      metals: 'Zinc, Aluminium, Silver, (mostly Lead)',
      woods: 'Pine, redusian birch',
      animals: 'Manta Tiger, Manta Bull',
      items: 'Tarnished Saborian Alloy, Momorosian Nylon Cloth, Weapon Calibration SDD, Electrical Filament, Glass Shards, Flight Records SSD',
      plants: 'Fiber, Berries, Azure, Tomato, Tomana, Beans'
    }
  },
  { lat: -6750, lng: 9150, level: 10, name: 'Rupture', number: 54, img: 'https://images.steamusercontent.com/ugc/24312098774332487/0C0525850207AA2F817A1993BF3C7F96DC54747A/?imw=637&imh=500&ima=fit&impolicy=Letterbox&imcolor=%23000000&letterbox=true' }
];

// Store marker references for island list interaction
const markerRefs = {};
markersData.forEach(data => {
  const color = getMarkerColor(data.level);
  // Rotate grid 90deg CCW, invert axes, then mirror both axes
  const markerLat = data.lng;
  const markerLng = -data.lat;
  // Mirror both axes
  const mirroredLat = markerLat;
  const mirroredLng = markerLng * -1;
  const iconHtml = `
    <div class="marker-circle" style="position: relative;">
      <img src="${data.img}" alt="${data.name}" style="width:100%;height:100%;object-fit:cover;position:absolute;top:0;left:0;z-index:1;">
      <div style="background-color: ${color}; opacity: 0.3; position:absolute;top:0;left:0;width:100%;height:100%;z-index:2;"></div>
      <span style="position:relative;z-index:3;display:inline-block;width:100%;height:100%;line-height:60px;font-size:28px;color:white;text-shadow:0 0 6px #000;font-weight:bold;">${data.number}</span>
    </div>
  `;
  const popupOptions = { autoPan: true };
if (mirroredLat > 7000) {
  popupOptions.offset = L.point(0, 0); // large negative Y moves popup below marker
}
const marker = L.marker([mirroredLat, mirroredLng], {
  icon: L.divIcon({
    className: '',
    html: iconHtml,
    iconSize: [60, 60],
    iconAnchor: [30, 30]
  })
})
.addTo(map)
.bindPopup(
  `<div style="
    position:relative;
    width:310px;
    min-height:480px;
    max-width:none;
    background: url('${data.img}') center center / cover no-repeat;
    border-radius: 16px;
    box-shadow: 0 2px 12px rgba(0,0,0,0.4);
    color:white;
    font-family:sans-serif;
    overflow:hidden;
    margin:0;
    padding:0;
  ">
    <div style="
      position:absolute;
      top:0; left:0; right:0; bottom:0;
      background:rgba(0,0,0,0.45);
      border-radius:16px;
      padding:30px 24px 18px 24px;
      pointer-events:none;
      width:100%;
      height:100%;
      box-sizing:border-box;
      display:block;
    ">
      <span style="font-size:36px;font-weight:bold;line-height:1.1;display:block;text-align:center;">${data.number}: ${data.name.replace(/_/g, ' ')}</span>
      <span style="font-size:16px;text-align:center;">Level: ${data.level}</span><br>
      <span>Lat: ${mirroredLat}</span><br>
      <span>Lng: ${mirroredLng}</span><br>
      ${data.details ? `
        ${data.details.altitude && data.details.altitude !== 'Not Reported' ? `<b>Altitude:</b> ${data.details.altitude}<br><br>` : ''}
        ${data.details.hasArk && data.details.hasArk !== 'Not Reported' ? `<b>Has Ark:</b> ${data.details.hasArk}<br>` : ''}
        ${data.details.databanks && data.details.databanks !== 'Not Reported' ? `<b>Databanks:</b> ${data.details.databanks}<br>` : ''}
        ${data.details.largeChest && data.details.largeChest !== 'Not Reported' ? `<b>Large Chest:</b> ${data.details.largeChest}<br><br>` : ''}
        ${data.details.metals && data.details.metals !== 'Not Reported' ? `<b>Metals:</b> ${data.details.metals}<br>` : ''}
        ${data.details.woods && data.details.woods !== 'Not Reported' ? `<b>Woods:</b> ${data.details.woods}<br>` : ''}
        ${data.details.plants && data.details.plants !== 'Not Reported' ? `<b>Plants:</b> ${data.details.plants}<br>` : ''}
        ${data.details.animals && data.details.animals !== 'Not Reported' ? `<b>Animals:</b> ${data.details.animals}<br>` : ''}
        ${data.details.items && data.details.items !== 'Not Reported' ? `<b>Items:</b> ${data.details.items}<br>` : ''}
      ` : ''}
    </div>
  </div>`
  , popupOptions
);
  markerRefs[data.number] = marker;

  // Hide island list and compass when popup opens, show when closes
  marker.on('popupopen', function() {
    document.getElementById('dropdown-popup').style.display = 'none';
    document.getElementById('compass').style.display = 'none';
  });
  marker.on('popupclose', function() {
    document.getElementById('dropdown-popup').style.display = '';
    document.getElementById('compass').style.display = '';
  });
});

const mapBounds = [[-40000, -40000], [40000, 40000]]; // Adjust size as needed
map.setMaxBounds(mapBounds);
map.setView([0, 0], 0); // Center map at (0,0) with zoom level 0

document.getElementById('dropdown-btn').onclick = function() {
  const list = document.getElementById('dropdown-list');
  list.style.display = list.style.display === 'block' ? 'none' : 'block';
};

// Make island list items clickable to center map and open popup
document.querySelectorAll('#dropdown-list li').forEach(li => {
  li.style.cursor = 'pointer';
  li.onclick = function() {
    const num = parseInt(li.textContent.split(':')[0]);
    const marker = markerRefs[num];
    if (marker) {
      map.setView(marker.getLatLng(), 0, { animate: true });
      marker.openPopup();
    }
    document.getElementById('dropdown-list').style.display = 'none';
  };
});
</script>
</body>
</html>






